<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anti-Trivia Leaderboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Hello Imperfect';
      src: url('/fonts/HelloImperfect.otf') format('opentype');
      font-weight: normal;
    }
    @font-face {
      font-family: 'Brother 1816 Printed';
      src: url('/fonts/Brother1816Printed-Bold.ttf') format('truetype');
      font-weight: bold;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 1920px;
      height: 1080px;
      overflow: hidden;
      background-color: #c8b89a;
      background-image: url('/images/paper.webp');
      background-size: cover;
      background-position: center;
      color: #1a1a1a;
      font-family: 'Poppins', 'Segoe UI', sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      flex-shrink: 0;
      text-align: center;
      padding: 36px 80px 28px;
      border-bottom: 3px solid #000;
      position: relative;
    }
    header h1 {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 10rem;
      color: #1a1a1a;
      text-shadow: none;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      line-height: 1;
    }
    .header-sub {
      display: inline-block;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 2.5rem;
      color: #1a1a1a;
      background: rgba(0,0,0,0.1);
      padding: 6px 36px;
      letter-spacing: 0.4em;
      text-transform: uppercase;
      margin-top: 14px;
      border-radius: 100px;
    }
    .q-badge {
      position: absolute;
      top: 36px;
      right: 80px;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 1.1rem;
      color: #1a1a1a;
      background: rgba(0,0,0,0.08);
      border: 2px solid #000;
      border-radius: 100px;
      padding: 8px 20px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      display: none;
    }
    .q-badge.show { display: block; }

    /* â”€â”€ Question banner â”€â”€ */
    .q-banner {
      flex-shrink: 0;
      margin: 18px 80px 0;
      padding: 18px 36px;
      background: rgba(0,0,0,0.07);
      border: 2px solid #000;
      border-left: 8px solid #000;
      border-radius: 0 16px 16px 0;
      display: none;
    }
    .q-banner.show { display: block; }
    .q-banner .label {
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 0.85rem;
      color: rgba(0,0,0,0.5);
      text-transform: uppercase;
      letter-spacing: 0.25em;
      margin-bottom: 6px;
    }
    .q-banner .text {
      font-size: 1.6rem;
      font-weight: 600;
      color: #1a1a1a;
      line-height: 1.35;
    }

    /* â”€â”€ Leaderboard rows â”€â”€ */
    .board {
      flex: 1;
      padding: 24px 80px 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow: hidden;
    }

    .row {
      display: flex;
      align-items: center;
      padding: 0 36px;
      background: rgba(0,0,0,0.07);
      border-radius: 16px;
      border-left: 8px solid #000;
      flex: 1;
      min-height: 0;
      animation: slideIn 0.35s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    .row.gold   { border-left-color: #000; background: rgba(0,0,0,0.1); }
    .row.silver { border-left-color: #000; background: rgba(0,0,0,0.08); }
    .row.bronze { border-left-color: #000; background: rgba(0,0,0,0.07); }

    .rank {
      font-family: 'Anton', sans-serif;
      font-size: 3rem;
      width: 120px;
      text-align: center;
      flex-shrink: 0;
      color: rgba(0,0,0,0.35);
      letter-spacing: 0.05em;
    }
    .gold   .rank { color: rgba(0,0,0,0.75); }
    .silver .rank { color: rgba(0,0,0,0.55); }
    .bronze .rank { color: rgba(0,0,0,0.45); }

    .name {
      flex: 1;
      font-family: 'Anton', sans-serif;
      font-size: 3rem;
      letter-spacing: 0.04em;
      padding: 0 40px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #1a1a1a;
    }

    .score-wrap {
      text-align: right;
      flex-shrink: 0;
      display: flex;
      align-items: baseline;
      gap: 10px;
    }
    .score {
      font-family: 'Anton', sans-serif;
      font-size: 4rem;
      color: #1a1a1a;
      line-height: 1;
      letter-spacing: 0.05em;
    }
    .pts-label {
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 1rem;
      color: rgba(0,0,0,0.45);
      text-transform: uppercase;
      letter-spacing: 0.2em;
    }

    .empty {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      color: rgba(0,0,0,0.3);
      font-size: 2rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
    }

    /* â”€â”€ Highlight overlay (drawing or text answer) â”€â”€ */
    .highlight-overlay {
      position: fixed;
      inset: 0;
      background-color: #c8b89a;
      background-image: url('/images/paper.webp');
      background-size: cover;
      background-position: center;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 24px 60px;
      gap: 18px;
    }
    .highlight-overlay.show { display: flex; }

    .highlight-team {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 3rem;
      color: #1a1a1a;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* Drawing answer */
    .highlight-img {
      flex: 1;
      min-height: 0;
      width: 100%;
      object-fit: contain;
      border-radius: 16px;
      border: 6px solid #000;
    }

    /* Text answer */
    .highlight-text {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 6rem;
      color: #1a1a1a;
      text-align: center;
      line-height: 1.2;
      letter-spacing: 0.06em;
      max-width: 1600px;
      word-break: break-word;
    }
  </style>
</head>
<body>

  <header>
    <h1>Slow Body</h1>
    <div class="header-sub">Anti-Trivia</div>
    <div class="q-badge" id="qBadge"></div>
  </header>

  <div class="q-banner" id="qBanner">
    <div class="label" id="qLabel">Current Question</div>
    <div class="text" id="qText"></div>
  </div>

  <div class="board" id="board">
    <div class="empty">Waiting for teams to join...</div>
  </div>

  <div class="highlight-overlay" id="highlightOverlay">
    <div class="highlight-team" id="highlightTeamName"></div>
    <img class="highlight-img" id="highlightImg" alt="drawing" style="display:none" />
    <div class="highlight-text" id="highlightText" style="display:none"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
    const tierClass = ['gold', 'silver', 'bronze'];

    socket.on('connect', () => socket.emit('leaderboard:join'));

    socket.on('display:highlight', data => {
      const overlay = document.getElementById('highlightOverlay');
      const img  = document.getElementById('highlightImg');
      const txt  = document.getElementById('highlightText');
      if (data && data.answer) {
        document.getElementById('highlightTeamName').textContent = data.name;
        const isImage = data.answer.startsWith('data:image');
        img.style.display  = isImage ? 'block' : 'none';
        txt.style.display  = isImage ? 'none'  : 'block';
        if (isImage) img.src = data.answer;
        else         txt.textContent = data.answer;
        overlay.classList.add('show');
      } else {
        overlay.classList.remove('show');
        img.src = '';
        txt.textContent = '';
      }
    });

    socket.on('leaderboard:update', teams => {
      const board = document.getElementById('board');
      if (!teams.length) {
        board.innerHTML = '<div class="empty">Waiting for teams to join...</div>';
        return;
      }
      board.innerHTML = teams.map((t, i) => {
        const tier = i < 3 ? tierClass[i] : '';
        const rankDisplay = i < 3 ? medals[i] : `#${i + 1}`;
        return `
          <div class="row ${tier}">
            <div class="rank">${rankDisplay}</div>
            <div class="name">${esc(t.name)}</div>
            <div class="score-wrap">
              <div class="score">${t.score}</div>
              <div class="pts-label">pts</div>
            </div>
          </div>`;
      }).join('');
    });

    socket.on('question:new', q => {
      const badge = document.getElementById('qBadge');
      badge.textContent = `Q${q.number}`;
      badge.classList.add('show');
      document.getElementById('qLabel').textContent = `Question ${q.number}`;
      document.getElementById('qText').textContent = q.text;
      document.getElementById('qBanner').classList.add('show');
    });

    socket.on('question:clear', () => {
      document.getElementById('qBanner').classList.remove('show');
      document.getElementById('qBadge').classList.remove('show');
    });

    function esc(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
  </script>
</body>
</html>
