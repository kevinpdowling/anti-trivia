<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anti-Trivia Leaderboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Hello Imperfect';
      src: url('/fonts/HelloImperfect.otf') format('opentype');
      font-weight: normal;
    }
    @font-face {
      font-family: 'Brother 1816 Printed';
      src: url('/fonts/Brother1816Printed-Bold.ttf') format('truetype');
      font-weight: bold;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 1920px;
      height: 1080px;
      overflow: hidden;
      background-color: #b8823c;
      color: #f0ece8;
      font-family: 'Poppins', 'Segoe UI', sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      flex-shrink: 0;
      text-align: center;
      padding: 36px 80px 28px;
      border-bottom: 4px solid #1a2c2f;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Cpath d='M40 10 C32 10 26 16 26 23 L26 30 C26 35 32 38 32 40 C32 42 26 45 26 50 L26 57 C26 64 32 70 40 70 C48 70 54 64 54 57 L54 50 C54 45 48 42 48 40 C48 38 54 35 54 30 L54 23 C54 16 48 10 40 10Z' fill='%23a06030' opacity='0.2'/%3E%3C/svg%3E");
      background-size: 80px 80px;
      position: relative;
    }
    header h1 {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 7rem;
      color: #fff;
      text-shadow: none;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      line-height: 1;
    }
    .header-sub {
      display: inline-block;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 1.05rem;
      color: #f0ece8;
      background: #2a3c3f;
      padding: 5px 22px;
      letter-spacing: 0.4em;
      text-transform: uppercase;
      margin-top: 12px;
      box-shadow: 5px 5px 0 #1a2c2f;
    }
    .q-badge {
      position: absolute;
      top: 36px;
      right: 80px;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 1.1rem;
      color: #cc8085;
      background: #2a3c3f;
      border: 2px solid #1a2c2f;
      padding: 8px 20px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      box-shadow: 4px 4px 0 #1a2c2f;
      display: none;
    }
    .q-badge.show { display: block; }

    /* â”€â”€ Question banner â”€â”€ */
    .q-banner {
      flex-shrink: 0;
      margin: 18px 80px 0;
      padding: 18px 36px;
      background: #2a3c3f;
      border: 2px solid #1a2c2f;
      border-left: 8px solid #cc8085;
      border-radius: 0 4px 4px 0;
      display: none;
      box-shadow: 6px 6px 0 #1a2c2f;
    }
    .q-banner.show { display: block; }
    .q-banner .label {
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 0.85rem;
      color: #cc8085;
      text-transform: uppercase;
      letter-spacing: 0.25em;
      margin-bottom: 6px;
    }
    .q-banner .text {
      font-size: 1.6rem;
      font-weight: 600;
      color: #f0ece8;
      line-height: 1.35;
    }

    /* â”€â”€ Leaderboard rows â”€â”€ */
    .board {
      flex: 1;
      padding: 24px 80px 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow: hidden;
    }

    .row {
      display: flex;
      align-items: center;
      padding: 0 36px;
      background: #2a3c3f;
      border-radius: 4px;
      border-left: 8px solid #1a2c2f;
      box-shadow: 6px 6px 0 #1a2c2f;
      flex: 1;
      min-height: 0;
      animation: slideIn 0.35s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    .row.gold   { border-left-color: #c9a227; background: linear-gradient(to right, rgba(201,162,39,0.2), #2a3c3f 40%); }
    .row.silver { border-left-color: #aaaaaa; background: linear-gradient(to right, rgba(170,170,170,0.12), #2a3c3f 40%); }
    .row.bronze { border-left-color: #cc6622; background: linear-gradient(to right, rgba(204,102,34,0.12), #2a3c3f 40%); }

    .rank {
      font-family: 'Anton', sans-serif;
      font-size: 3rem;
      width: 120px;
      text-align: center;
      flex-shrink: 0;
      color: #3a5558;
      letter-spacing: 0.05em;
    }
    .gold   .rank { color: #c9a227; text-shadow: 0 0 30px rgba(201,162,39,0.4); }
    .silver .rank { color: #aaaaaa; }
    .bronze .rank { color: #cc6622; }

    .name {
      flex: 1;
      font-family: 'Anton', sans-serif;
      font-size: 3rem;
      letter-spacing: 0.04em;
      padding: 0 40px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #f0ece8;
    }

    .score-wrap {
      text-align: right;
      flex-shrink: 0;
      display: flex;
      align-items: baseline;
      gap: 10px;
    }
    .score {
      font-family: 'Anton', sans-serif;
      font-size: 4rem;
      color: #c49a35;
      line-height: 1;
      letter-spacing: 0.05em;
    }
    .pts-label {
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      font-size: 1rem;
      color: #cc8085;
      text-transform: uppercase;
      letter-spacing: 0.2em;
    }

    .empty {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Brother 1816 Printed', 'Anton', sans-serif;
      color: #a06030;
      font-size: 2rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
    }

    /* â”€â”€ Highlight overlay (drawing or text answer) â”€â”€ */
    .highlight-overlay {
      position: fixed;
      inset: 0;
      background-color: #b8823c;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 24px 60px;
      gap: 18px;
    }
    .highlight-overlay.show { display: flex; }

    .highlight-team {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 3rem;
      color: #fff;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* Drawing answer */
    .highlight-img {
      max-width: 1760px;
      max-height: 940px;
      border-radius: 6px;
      border: 6px solid #2a3c3f;
      box-shadow: 10px 10px 0 #1a2c2f;
      object-fit: contain;
    }

    /* Text answer */
    .highlight-text {
      font-family: 'Hello Imperfect', 'Anton', sans-serif;
      font-size: 6rem;
      color: #fff;
      text-align: center;
      line-height: 1.2;
      letter-spacing: 0.06em;
      max-width: 1600px;
      word-break: break-word;
    }
  </style>
</head>
<body>

  <header>
    <h1>Slow Body</h1>
    <div class="header-sub">Anti-Trivia Â· Live Leaderboard</div>
    <div class="q-badge" id="qBadge"></div>
  </header>

  <div class="q-banner" id="qBanner">
    <div class="label" id="qLabel">Current Question</div>
    <div class="text" id="qText"></div>
  </div>

  <div class="board" id="board">
    <div class="empty">Waiting for teams to join...</div>
  </div>

  <div class="highlight-overlay" id="highlightOverlay">
    <div class="highlight-team" id="highlightTeamName"></div>
    <img class="highlight-img" id="highlightImg" alt="drawing" style="display:none" />
    <div class="highlight-text" id="highlightText" style="display:none"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
    const tierClass = ['gold', 'silver', 'bronze'];

    socket.on('connect', () => socket.emit('leaderboard:join'));

    socket.on('display:highlight', data => {
      const overlay = document.getElementById('highlightOverlay');
      const img  = document.getElementById('highlightImg');
      const txt  = document.getElementById('highlightText');
      if (data && data.answer) {
        document.getElementById('highlightTeamName').textContent = data.name;
        const isImage = data.answer.startsWith('data:image');
        img.style.display  = isImage ? 'block' : 'none';
        txt.style.display  = isImage ? 'none'  : 'block';
        if (isImage) img.src = data.answer;
        else         txt.textContent = data.answer;
        overlay.classList.add('show');
      } else {
        overlay.classList.remove('show');
        img.src = '';
        txt.textContent = '';
      }
    });

    socket.on('leaderboard:update', teams => {
      const board = document.getElementById('board');
      if (!teams.length) {
        board.innerHTML = '<div class="empty">Waiting for teams to join...</div>';
        return;
      }
      board.innerHTML = teams.map((t, i) => {
        const tier = i < 3 ? tierClass[i] : '';
        const rankDisplay = i < 3 ? medals[i] : `#${i + 1}`;
        return `
          <div class="row ${tier}">
            <div class="rank">${rankDisplay}</div>
            <div class="name">${esc(t.name)}</div>
            <div class="score-wrap">
              <div class="score">${t.score}</div>
              <div class="pts-label">pts</div>
            </div>
          </div>`;
      }).join('');
    });

    socket.on('question:new', q => {
      const badge = document.getElementById('qBadge');
      badge.textContent = `Q${q.number}`;
      badge.classList.add('show');
      document.getElementById('qLabel').textContent = `Question ${q.number}`;
      document.getElementById('qText').textContent = q.text;
      document.getElementById('qBanner').classList.add('show');
    });

    socket.on('question:clear', () => {
      document.getElementById('qBanner').classList.remove('show');
      document.getElementById('qBadge').classList.remove('show');
    });

    function esc(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
  </script>
</body>
</html>
